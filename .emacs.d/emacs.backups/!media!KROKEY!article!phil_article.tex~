\documentclass{article}
\usepackage{amsmath,amssymb,spconf,graphicx}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\title{Metric Tensor for Multicomponent Edge Detection}

\twoauthors{Sylvain Rousseau\sthanks{This work was supported by the Délégation Générale de l'Armement.}, David Helbert, Philippe Carr\'e}{XLIM, CNRS, University of Poitiers,\\
  BP 30179 86962 Futuroscope Chasseneuil - France \\
  rousseau@sic.univ-poitiers.fr}{Jacques Blanc-Talon}{DGA/D4S/MRIS
  Bagneux, France}

\begin{document}

\maketitle

\begin{abstract}
  In this paper, we present the use of differential geometry for the
  segmentation of multispectral images, which allows us to unify
  several known methods including projecting onto a particular axis or
  a particular plan. This is done by choosing a metric tensor on the
  feature space computing the pullback of the metric
  tensor and applying standard Di Zenzo algorithm.
\end{abstract}

\begin{keywords}
  metric tensor, Riemannian manifold, metric pullback
\end{keywords}

\section{Introduction}
\label{sec:intro}

Edge detection is a basic step for image understanding and computer
vision.  Since abrupt gray-level changes occur at edge points, most
edge detection algorithms use image gradient information. Edge
detection for color image presents some challenges. The common
technique is to look for discontinuities in luminance component and
while ignoring chrominance information.

This paper proposes to review and to extend multicomponent classical
method with differential geometry. This method contains two steps:
metric tensor caculation and edge detection with Di Zenzo's
algorithm. The choice of a particular metric tensor on the space
feature will induce different edge detection methods. The synthetic
image we use serve as a proof-of-concept.

The outline of the paper is as follows. Section \ref{sec:classical}
reviews the classical approach of the gradient. Section \ref{sec:riem}
describes the Riemannian tools used to detect particular edges, and
various color difference equations. Section \ref{sec:spatial} shows
the performance of the edge detection algorithm. Section
\ref{sec:conc} presents concluding remarks.


\section{The classical point of view}
\label{sec:classical}

A gradient of a multi-image introduced in \cite{di1986note} relies on
some tools of differential analysis. A $m$-dimensional image is indeed
proposed to be viewed as a map $f$ from a domain
$D\subset\mathbb{R}^2$ to the so called space feature
$\mathbb{R}^m$. The set $\varphi(D)$ is then a sub-manifold of
$\mathbb R^m$ provided that the Jacobian is of rank 2 everywhere and
that $f$ is injective.
\begin{equation*}
  \begin{matrix}
    f:&D&\longrightarrow&\mathbb{R}^{m}\\
    &(x,y)&\longmapsto&(f^1(x, y),\dotsc,f^m(x, y))\\
  \end{matrix}
\end{equation*}

Let $f_1=(\frac{\partial f^1}{\partial x}$ $ ,\dotsc,\frac{\partial
  f^m}{\partial x})$ and $f_2=(\frac{\partial f^1}{\partial
  y},\dotsc,\frac{\partial f^m}{\partial y})$. A tensor $T$ on
$\varphi(D)$ is then introduced:

\begin{equation*}
  T=
  \begin{pmatrix}
    \|f_1\|^2&f_1\cdot f_2\\
    f_1\cdot f_2&\|f_2\|^2
  \end{pmatrix},
\end{equation*}
which can be written
\begin{equation*}
  J^TJ\quad\mathrm{where}\quad J^T=\begin{pmatrix}
    \frac{\partial f^1}{\partial x} & \cdots  &\frac{\partial f^m}{\partial x}\\ 
    \frac{\partial f^1}{\partial y} &  \cdots &\frac{\partial f^m}{\partial y} 
  \end{pmatrix}.
\end{equation*}
Edges of the image are detected by maximizing this tensor. We remark
that these tensors given on each point of the image define no more
than a metric on the domain $D$.

The function $f$ can be slightly modified as pointed out in
\cite{cumani1991edge} by adding two space coordinates:
\begin{equation*}
  \begin{matrix}
    \varphi:&D&\longrightarrow&\mathbb{R}^{m+2}\\
    &(x,y)&\longmapsto&(x, y, \varphi^1(x, y),\cdots,\varphi^m(x, y))\\
  \end{matrix}
\end{equation*}
The application $\varphi$ is then an embedding.

\section{Riemannian tools}
\label{sec:riem}

\subsection{Concepts}

A mathematical approach can be seen in \cite{sochen1998general,
  batard2009metric} where Riemannian tools are used. We still have the
embedding $\varphi$ but the metric tensor $T$ is viewed as the
pullback of a metric tensor $g$ defined on $\mathbb{R}^{m+2}$. Let us
recall some mathematical facts. Let $M^m$ and $N^n$ two Riemannian
manifold and $\varphi:M^m\longrightarrow N^n$ an embedding of $M^m$ in
$N^n$. Given a (pseudo-)Riemannian metric $g$ on $N$, we can construct
one on $M$ called the pullback of $g$ and denoted $\varphi^*g$. The
expression of $\varphi^*g$ is given by:
\begin{equation*}
  \varphi^*g=J^TgJ,
\end{equation*}
where $J$ is the Jacobian of $\varphi$.

\subsection{Application with various metrics}

In this section, we will show that choosing a particular uniform
metric on the space feature will induce different known methods.\\

Suppose $m=1$, we have a grey-level image of intensity $I$. Then,
\begin{equation*}
  \begin{matrix}
    \varphi:&D&\longrightarrow&\mathbb{R}^{3}\\
    &(x,y)&\longmapsto&(x, y, I(x, y))\\
  \end{matrix}
\end{equation*}
and
\begin{equation*}
  J=
  \begin{pmatrix}
    1&0\\
    0&1\\
    I_x&I_y\\
  \end{pmatrix},
\end{equation*}
where $\frac{\partial I}{\partial x}$ is denoted by $I_x$ and
$\frac{\partial I}{\partial y}$ by $I_y$.  If $\mathbb R^3$ is endowed
with the (pseudo-)metric,
\begin{equation*}
  g=\begin{pmatrix}
    0&0&0\\
    0&0&0\\
    0&0&1\\
  \end{pmatrix},
\end{equation*}
then we get:
\begin{equation*}
  \varphi^*g=
  \begin{pmatrix}
    I_x^2&I_xI_y\\
    I_xI_y&I_y^2\\
  \end{pmatrix}
\end{equation*}
which is the metric tensor on $D$ obtain by Di Zenzo. This tensor is
then obtained by choosing the metric tensor
\begin{equation*}
  \begin{pmatrix}
    0&0&0\\
    0&0&0\\
    0&0&1\\
  \end{pmatrix}
\end{equation*}
on the space feature.\\

Suppose now the case of a color image with $m=3$:
\begin{equation*}
  \begin{matrix}
    \varphi:&D&\longrightarrow&\mathbb{R}^{5}\\
    &(x,y)&\longmapsto&(x, y, I^1(x, y), I^2(x, y), I^3(x ,y))\\
  \end{matrix}
\end{equation*}
where $I^1, I^2, I^3$ correspond respectively to the red, green and
blue component of the image. Different algorithms will be applied to
the synthetic image \ref{fig:synthetic}:

\begin{figure}[!htb]
  \begin{center}
    \includegraphics[scale=0.6]{img/croissant.png}
    \caption{Synthetic test image.}
    \label{fig:synthetic}
  \end{center}
\end{figure}

We can perform marginal methods simply by choosing a metric of the
form:
\begin{equation}\label{rouge}
  g=
  \begin{pmatrix}
    0&0&0&0&0\\
    0&0&0&0&0\\
    0&0&1&0&0\\
    0&0&0&0&0\\
    0&0&0&0&0\\
  \end{pmatrix},
\end{equation}
so
\begin{equation*}
  \varphi^*g=
  \begin{pmatrix}
    (I^1_x)^2&I^1_xI^1_y\\
    I^1_xI^1_y&(I^1_y)^2\\
  \end{pmatrix}.
\end{equation*}

\begin{figure}[!htb]
  \begin{center}
    \includegraphics[scale=0.6]{img/croissant_rouge.png}
    \caption{Di Zenzo algorithm with metric \eqref{rouge}.}
    \label{fig:rouge}
  \end{center}
\end{figure}
In this case, we are only looking at the red component so there no distinction between red and yellow.\\

In this example, we are interested in another particular direction
that is the grey axis. This is done by choosing:
\begin{equation}\label{metrique_gris}
  g=
  \begin{pmatrix}
    1&0&0&0&0\\
    0&1&0&0&0\\
    0&0&1&1&1\\
    0&0&1&1&1\\
    0&0&1&1&1\\
  \end{pmatrix}
\end{equation}
The pullback metric is:
\begin{equation*}
  \varphi^*g=
  \begin{pmatrix}
    \displaystyle 1+\sum_{i=1}^3(I_x^i)^2&\displaystyle\sum_{i=1}^3I_x^i I_y^i\\
    \displaystyle\sum_{i=1}^3I_x^i I_y^i&1+\displaystyle\sum_{i=1}^3(I_y^i)^2\\
  \end{pmatrix},
\end{equation*}
which give the following expected result: edges between region with same luminance (red and green) are not detected.
\begin{figure}[!htb]
  \begin{center}
    \includegraphics[scale=0.6]{img/croissant_gris.png}
    \caption{Di Zenzo algorithm with metric \eqref{metrique_gris}.}
    \label{fig:contraste}
  \end{center}
\end{figure}

More generally, we can choose a particular direction on which to
project. Let $u=(a, b, c)^T$ a unit vector.  Take the quadratic form
$Q=uu^T$. We have $Q(u)=u^TQu=1$ and $Q(v)=0$ for any vector
orthogonal to $u$. The metric is then of the form:
\begin{equation}\label{metrique_abc}
  g=
  \begin{pmatrix}
    1&0\\
    0&1\\
  \end{pmatrix}\oplus
  \begin{pmatrix}
    a^2&ab&ac\\
    ab&b^2&bc\\
    ac&bc&c^2
  \end{pmatrix}
\end{equation}
The metric \eqref{metrique_gris} can then be found up to a scalar by
choosing $u=\frac{1}{\sqrt{3}}(1, 1, 1)^T$.\\

In the last example we choose a metric that will only take into
account the chromaticity of the color. More generally we are looking
for a quadratic form that is degenerate along one direction and
Euclidean on the space orthogonal to that direction. Let $u$ that
degenerate direction and $v, w$ so that $(u, v, w)$ is an orthonormal
frame. Let $Q=vv^T+ww^T$, then $Q(u)=0$ and $Q(v)=Q(w)=1$. If we
suppose $u=\frac 1 {\sqrt 3} (1, 1, 1)^T$ then:
\begin{equation}\label{chroma}
  g=
  \begin{pmatrix}
    1&0\\
    0&1\\
  \end{pmatrix}\oplus\frac 1 3
  \begin{pmatrix}
    2&-1&-1\\
    -1&2&-1\\
    -1&-1&2\\
  \end{pmatrix}
\end{equation}

\begin{figure}[!htb]
  \begin{center}
    \includegraphics[scale=0.6]{img/croissant_eucl.png}
    \caption{Di Zenzo algorithm with metric \eqref{chroma}.}
    \label{fig:contraste}
  \end{center}
\end{figure}

Marginal methods, intensity methods and chromaticity methods can be
performed simply by choosing a particular matrix, computing the
pullback and applying the usual algorithm. The interesting thing here
is that we can mix these methods and apply at a point of a given color
one method and one other method at some other location.

\section{Edge detection with spatial adaptative metrics}
\label{sec:spatial}

In the previous section, we have seen some examples using uniform
metrics. But metrics can be computed locally to improve edge
detection. For example, we are considering in this section a metric of
the form \eqref{metrique_abc}. The direction $u(x, y)$ is set to the
first principal component of pixels located in a window of fixed size
centered in $(x, y)$.

Let us consider the following synthetic image where the noise is
orthogonal to the principal direction of the image.
\begin{figure}[!htb]
  \begin{center}
    \includegraphics[scale=0.6]{img/band.png}
    \caption{Noisy image.}
    \label{fig:contraste}
  \end{center}
\end{figure}

We apply the usual algorithm corresponding to the Euclidean metric.
\begin{figure}[!htb]
  \begin{center}
    \includegraphics[scale=0.6]{img/band_eucl.png}
    \caption{Di Zenzo algorithm with Euclidean metric.}
    \label{fig:contraste}
  \end{center}
\end{figure}
The edge is not detected because the noise is considered by the
Euclidean metric as edges.\\

On the other hand, when we choose metric of the form
\eqref{metrique_abc} where $u$ is the principal direction of the
image, the noise is reduced because it is orthogonal to the principal
direction.
\begin{figure}[!htb]
  \begin{center}
    \includegraphics[scale=0.6]{img/band_SVD.png}
    \caption{Di Zenzo algorithm with SVD metric.}
    \label{fig:contraste}
  \end{center}
\end{figure}

\section{Conclusion}
\label{sec:conc}

This paper presents a framework based on some mathematical concepts
that allows us to consider simultaneously several edge detection
methods. Marginal method and luminance method can be reduced to the
choice of a $3\times 3$ matrix. Different methods can be spatially
combined. We have processed a synthetic image, to illustrate the
potential of this framework. We would like to investigate further with
hyperspectral images using a tensor metric field depending on spectral
signatures.

\bibliographystyle{IEEEbib} \bibliography{strings,refs}

\end{document}